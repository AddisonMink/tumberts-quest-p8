pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include ui.lua
#include inventory-ui.lua
#include add-item-ui.lua
#include select-items-ui.lua
#include hud-ui.lua
#include sprite.lua
#include player.lua
#include redcap.lua
#include scamp.lua
#include witch.lua
#include cutthroat.lua
#include battle.lua
#include item.lua
#include world.lua

max_items = 5
ui = ui_module()
sprite = sprite_module()
hud = hud_ui_module()
battle_util = battle_util_module()
items = item_module()

inventory = {}

battles = {
  [10 .. "," .. 3] = {
    { f = add_redcap, col = 4, row = 2 },
    { f = add_scamp, col = 6, row = 1 }
  },
  [4 .. "," .. 3] = {
    { f = add_redcap, col = 4, row = 1 },
    { f = add_cutthroat, col = 5, row = 2 }
  },
  [1 .. "," .. 7] = {
    { f = add_cutthroat, col = 4, row = 1 },
    { f = add_witch, col = 5, row = 2 }
  },
  [7 .. "," .. 9] = {
    { f = add_redcap, col = 4, row = 2 },
    { f = add_redcap, col = 4, row = 3 },
    { f = add_witch, col = 5, row = 1 }
  },
  [13 .. "," .. 9] = {
    { f = add_redcap, col = 4, row = 2 },
    { f = add_witch, col = 5, row = 1 },
    { f = add_witch, col = 6, row = 3 }
  },
  [13 .. "," .. 11] = {
    { f = add_cutthroat, col = 4, row = 1 },
    { f = add_cutthroat, col = 4, row = 3 },
    { f = add_witch, col = 5, row = 2 }
  },
  [10 .. "," .. 11] = {
    { f = add_cutthroat, col = 5, row = 1 },
    { f = add_redcap, col = 4, row = 1 },
    { f = add_redcap, col = 4, row = 3 }
  }
}

treasures = {
  [1 .. "," .. 1] = items.axe,
  [13 .. "," .. 1] = items.axe,
  [1 .. "," .. 5] = items.axe,
  [13 .. "," .. 5] = items.axe,
  [7 .. "," .. 7] = items.axe,
  [1 .. "," .. 11] = items.axe
}

world = world_module(inventory, max_items, treasures, battles)
--battle = battle_module()

function tick(timer)
  if timer.t > 0 then timer.t -= 1 / 30 end
  return timer.t <= 0
end

function _init()
  srand(time())
end

function _update()
  world:update()
  --battle:update()
end

function _draw()
  cls()
  world:draw()
  --battle:draw()
  if debug_msg then print(debug_msg, 64, 16, 15) end
end

__gfx__
0000000000ffffffffffff00333bb333000cc0003399993300111111111111000022222222222200000000000000000000000000000000000000000000000000
000000000f111111111111f033bbbb3300cccc0039444493055555555555551002555555555555200c0000000000000000000000000000000000888800000000
00000000f11111111111111f33bb3333cccccccc94444449155555555555555125555555555555520c0000000000000000000000000000000008888880000000
00000000f11111111111111f3bbbbbb3007777004449944415555555555555512555555555555552cc7777777700000000007777777770000008008880000000
00000000f11111111111111f33b33bb30cc55cc09999999915555555555555512555555555555552cc7777770000000000000000000000000000888888000000
00000000f11111111111111fbb3bb33b4477774444499444155555555555555125555555555555520c000000000000000000000000000000000f888f8ff00000
00000000f11111111111111f333443334777777494444449155555555555555125555555555555520c00000000000000000000000000000000ffff0f80f00000
00000000f11111111111111f333443330440044099999999155555555555555125555555555555520000000000000000000000000000000000ff0ffffff00000
00000000f11111111111111f33333333000cc00056666665155555555555555125555555555555520000000000000000007777777777777000fff0ffff444000
07700000f11111111111111f33b3333300cccc00666556661555555555555551255555555555555200000000000000000000000000000000000fff4444004400
07770000f11111111111111f3b333333cccccccc6655556615555555555555512555555555555552000000000000000000000000000000000000444440fff400
07777000f11111111111111f3b333b330077770066555566155555555555555125555555555555524444444447700000000000000000000000ff444440fff400
07770000f11111111111111f33333b3344c55cc066655666015555555555551002555555555555204444444777000000000000000000000000ff444440fff400
07700000f11111111111111f33b333334477777466655666001111111111110000222222222222000000000777000000000077777777700000ff0444444ff400
000000000f111111111111f033b333b3077774446655556600000000000000000000000000000000000000777770000000000000000000000000ff44ff444000
0000000000ffffffffffff0033333333044004405666666500000000000000000000000000000000000000000000000000000000000000000fffff00fffff000
0ffffff00ffffff0336ff63333d33d3d338888333334433300000000000000000000000000000000000000000000000000000000000000000000000000000000
f000000ffffff55f336ff633333dddd338888883334444330000000cc000000000000000cc000000000000000000000000000088880000000000888800000000
f000000fffff555f336ff633d3dddd3388888888344444430000000cc000000000000000cc000000000000007000000000000888888000000008888880000000
f000000ff5f555ff336ff6333d5d5ddd8808808844666644000000cccc0000000000000cccc00000000000007000000000000800888000000008008880000000
f000000fff555fff336ff63333dddd338808808836644663000003cccc3000000000003cccc30000000700007000070000000088888800000000888888000000
f000000ff555ffff336ff63333d5dd3338800883366446630ccccc3333ccccc000000cc3333ccccc0007000070000700000f0f888f8ff000000f888f8ff00000
f000000ff55f5fff336ff6333dd5dd3333888833366446630000cccccccc000000ccccccccccc000000700007000070000f0ffff0f80f00000ffff0f80f00000
0ffffff00ffffff0336ff633dd3dd3dd338888333366663300000777707000000000007777070000000700007000070000f0ff0ffffff00000ff0ffffff00000
0ffffff0336666333333333333333333336633660ffffff000000cccc70000000c03300cc7770000000700007000070000f0fff0ffff444000fff0ffff000000
ffff5fff36ffff633333333333d3333366336633fff5555f000cc0000cc000000c0337000cc00000000700007000070000000fff44440044000fff4444ff0000
fff5f5ff6ffffff6666666663d33333333663366fff5ff5f00cc0330770330000c033777777733300007000070000700000000444440fff4ff04444444fff000
f555555f6ffffff6ffffffff3d333d3366336633fff5f55f0cc03337777030000cc007777777333000070000700007000000ff444440fff4fff4444444fff000
f555555f6ffffff6ffffffff33333d3333663366ff55ffff0cc00337777000000ccc0777777700000007000070000700000ffff44440fff4ffff4444444ff000
fff5f5ff6ffffff66666666633d3333366336633ff5fffff0cc037777703000000c03077777330000000000070000000000ffff444444ff40000444444400000
ffff5fff36ffff633333333333d333d333663366f5ffffff0c033330003330000000330000333300000000000000000000000fff44ff4440000ff444ff400000
0ffffff0336666333333333333333333663366330ffffff00000000000000000000000000000000000000000000000000000000000fffff0fffff000fffff000
00000000000000000000000000000000000a090a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000044000000000000000000000000090090900a0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00440000004440007700000000007000000099900990000000000033033000000000000000000000000000000000000000000000000000000000000000000000
0044400000074000077000000000777000a099999990a0a0000033f3330070000000000000000000000000000000000000000000000000000000000000000000
007004400007440044444444444447770a9900000a09a0a000333333330070000000000000000000000000000000000000000000000000000000000000000000
070000400007040007700000000077700a00aaa000000aa000000333300070000000033033300000000000000000000000000000000000000000000000000000
0700000400070400770000000000700000a0aaaaaaaaaaa00000000333066600000000333f330000000000000000000000000000000000000000000000000000
7000000400070400000000000000000000aaaaaaaaaaaa0000030ddddd3360000000000333333300000000000000000000000000000000000000000000000000
70000004000704000000000000000000000000000000000000030ddddd3360000000000033333000000000000000000000000000000000000000000000000000
070000040007040000000000000000000000900000090000000000ddd00000000000000033300000000000000000000000000000000000000000000000000000
07000040000704000000000000000000000a09900090a00000033330d300000000000000dddd3333000000000000000000000000000000000000000000000000
007004400007440000000009000000000a000999999000a000444440033000000000000ddddd3333000000000000000000000000000000000000000000000000
0044400000074000000000979900000000aa990009999aa000000004433440000000000dddd00000000000000000000000000000000000000000000000000000
0044000000444000000009977a90000000a00000a0000aa000000004000000000000000ddd300000000000000000000000000000000000000000000000000000
000000000044000000009aa777a900000a0000000000a0a000000004000000000000333003330000000000000000000000000000000000000000000000000000
000000000000000000000aaaaaa0000000aaaaaaaaaaaa0000000004000000000000333003333000000000000000000000000000000000000000000000000000
000000000000000000d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000800000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000800000000ddd00ddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000008880000000dddfdddd000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000
000000008880000000ddfdddd0000dd0009000000000000000000000000000006677770000000000000000000000000000000000000000000000000000000000
000000088888000000ffdddd0000dd00009900000000000000003303330000000600000000000000000000000000000000000000000000000000000000000000
0000000f888ff0000dddddd3000ddd00000990000000990000000333f33000000000000000000000000000000000000000000000000000000000000000000000
000000ff0fff0000dddddd3300dd0dd0000999000009900000000033333330000000000000000000000000000000000000000000000000000000000000000000
0000000ffff00000dddddf33ddd0ddd00099a9000099990000000003333300000000000000000000000000000000000000000000000000000000000000000000
000000008ff0ff000003333ddd0ddddf099aaa000099990000033063300000000000000000000000000000000000000000000000000000000000000000000000
00000ff88888ff00003333ddddddddf499aa7a090999a99000036667777000000000000000000000000000000000000000000000000000000000000000000000
00000fff888ff00003300dddd0dddf4f09aa77999999aa9900000d6dd00000000044444000000000000000000000000000000000000000000000000000000000
00000008888800000000dd0ddd0ddff409aa77a9999a7aa90000dddd000000000000000444444000000000000000000000000000000000000000000000000000
0000000ff8ff0000000dd0ddddd4400f097777799aa777a90000dddd300000000000000400000000000000000000000000000000000000000000000000000000
000000fff0fff0000000ddd4d4000000007777700977777900033003330000000000000400000000000000000000000000000000000000000000000000000000
00000000000000000044444000000000000777000077770000033003330000000000000400000000000000000000000000000000000000000000000000000000
__map__
1313131313131313131313131313330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305031331323231323231323205130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322131322031315131322130313130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1331323224323231330324323231130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322031313130322131322131322130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305133331323225323231132305130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1303131322031313330315133303130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1324323231323205133331323231230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322331322130323332322332322330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1331031331323224323231133324330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322132315133322033315233322230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305323231323231232324323224330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1333131313331313333333232333230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
