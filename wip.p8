pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include ui.lua
#include inventory-ui.lua
#include add-item-ui.lua
#include select-items-ui.lua
#include hud-ui.lua
#include sprite.lua
#include player.lua
#include redcap.lua
#include battle.lua
#include world.lua

max_items = 5
ui = ui_module()
sprite = sprite_module()
hud = hud_ui_module(max_items)
battle_util = battle_util_module()

items = {
  { name = "axe", desc = "swing axe", icon = 33 },
  { name = "bow", desc = "shoot bow", icon = 48 }
}

treasures = {
  [7 .. "," .. 7] = items[2]
}

world = world_module(items, max_items, treasures)
battle = battle_module()

function tick(timer)
  if timer.t > 0 then timer.t -= 1 / 30 end
  return timer.t <= 0
end

function _init()
end

function _update()
  --world:update()
  battle:update()
end

function _draw()
  cls()
  --world:draw()
  battle:draw()
end

__gfx__
0000000000ffffffffffff00333bb333000cc0003399993300111111111111000022222222222200000000000000000000000000000000000000000000000000
000000000f111111111111f033bbbb3300cccc0039444493055555555555551002555555555555200c0000000000000000000000000000000000888800000000
00000000f11111111111111f33bb3333cccccccc94444449155555555555555125555555555555520c0000000000000000000000000000000008888880000000
00000000f11111111111111f3bbbbbb3007777004449944415555555555555512555555555555552cc7777777700000000007777777770000008008880000000
00000000f11111111111111f33b33bb30cc55cc09999999915555555555555512555555555555552cc7777770000000000000000000000000000888888000000
00000000f11111111111111fbb3bb33b4477774444499444155555555555555125555555555555520c000000000000000000000000000000000f888f8ff00000
00000000f11111111111111f333443334777777494444449155555555555555125555555555555520c00000000000000000000000000000000ffff0f80f00000
00000000f11111111111111f333443330440044099999999155555555555555125555555555555520000000000000000000000000000000000ff0ffffff00000
00000000f11111111111111f33333333000cc00056666665155555555555555125555555555555520000000000000000007777777777777000fff0ffff444000
07700000f11111111111111f33b3333300cccc00666556661555555555555551255555555555555200000000000000000000000000000000000fff4444004400
07770000f11111111111111f3b333333cccccccc6655556615555555555555512555555555555552000000000000000000000000000000000000444440fff400
07777000f11111111111111f3b333b330077770066555566155555555555555125555555555555524444444447700000000000000000000000ff444440fff400
07770000f11111111111111f33333b3344c55cc066655666015555555555551002555555555555204444444777000000000000000000000000ff444440fff400
07700000f11111111111111f33b333334477777466655666001111111111110000222222222222000000000777000000000077777777700000ff0444444ff400
000000000f111111111111f033b333b3077774446655556600000000000000000000000000000000000000777770000000000000000000000000ff44ff444000
0000000000ffffffffffff0033333333044004405666666500000000000000000000000000000000000000000000000000000000000000000fffff00fffff000
0ffffff00ffffff0336ff63333d33d3d338888333334433300000000000000000000000000000000000000000000000000000000000000000000000000000000
f000000ffffff55f336ff633333dddd338888883334444330000000cc000000000000000cc000000000000000000000000000088880000000000888800000000
f000000fffff555f336ff633d3dddd3388888888344444430000000cc000000000000000cc000000000000007000000000000888888000000008888880000000
f000000ff5f555ff336ff6333d5d5ddd8808808844666644000000cccc0000000000000cccc00000000000007000000000000800888000000008008880000000
f000000fff555fff336ff63333dddd338808808836644663000003cccc3000000000003cccc30000000700007000070000000088888800000000888888000000
f000000ff555ffff336ff63333d5dd3338800883366446630ccccc3333ccccc000000cc3333ccccc0007000070000700000f0f888f8ff000000f888f8ff00000
f000000ff55f5fff336ff6333dd5dd3333888833366446630000cccccccc000000ccccccccccc000000700007000070000f0ffff0f80f00000ffff0f80f00000
0ffffff00ffffff0336ff633dd3dd3dd338888333366663300000777707000000000007777070000000700007000070000f0ff0ffffff00000ff0ffffff00000
0ffffff0336666333333333333333333336633660000000000000cccc70000000c03300cc7770000000700007000070000f0fff0ffff444000fff0ffff000000
ffff5fff36ffff633333333333d333336633663300000000000cc0000cc000000c0337000cc00000000700007000070000000fff44440044000fff4444ff0000
fff5f5ff6ffffff6666666663d333333336633660000000000cc0330770330000c033777777733300007000070000700000000444440fff4ff04444444fff000
f555555f6ffffff6ffffffff3d333d3366336633000000000cc03337777030000cc007777777333000070000700007000000ff444440fff4fff4444444fff000
f555555f6ffffff6ffffffff33333d3333663366000000000cc00337777000000ccc0777777700000007000070000700000ffff44440fff4ffff4444444ff000
fff5f5ff6ffffff66666666633d3333366336633000000000cc037777703000000c03077777330000000000070000000000ffff444444ff40000444444400000
ffff5fff36ffff633333333333d333d333663366000000000c033330003330000000330000333300000000000000000000000fff44ff4440000ff444ff400000
0ffffff033666633333333333333333366336633000000000000000000000000000000000000000000000000000000000000000000fffff0fffff000fffff000
__map__
1313131313131313131313131313330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305031331323231323231323205130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322131322031315131322130313130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1331323224323231330324323231130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322031313130322131322131322130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305133331323225323231132305130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1303131322031313330315133303130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1324323231323205133331323231230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322331322130323332322332322330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1331031331323224323231133324330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1322132315133322033315233322230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1305323231323231232324323224330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1333131313331313333333232333230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
